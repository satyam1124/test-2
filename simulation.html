<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOB Guard - Realistic Maritime Simulation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="css/simulation.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<base target="_blank">
</head>
<body>

    <div class="header">
        <div class="logo">
            <i class="fas fa-anchor"></i>
            <span>MOB Guard - Maritime Simulation</span>
        </div>
        <a href="./index.html" class="back-btn" onclick="return confirmExit()">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <!-- Maneuver Indicator -->
    <div id="maneuver-indicator" class="maneuver-indicator">
        <i class="fas fa-sync-alt fa-spin"></i> EXECUTING RECOVERY TURN
    </div>

    <!-- MOB Emergency Modal -->
    <div id="mob-modal" class="mob-modal">
        <div class="mob-content">
            <i class="fas fa-life-ring mob-icon"></i>
            <h2 class="mob-title">MAN OVERBOARD!</h2>
            <p style="color: #ff8888; margin-bottom: 20px;">Immediate Action Required - IAMSAR Protocol</p>
            
            <div class="mob-details" id="mob-details"></div>
            
            <div class="survival-bar">
                <div class="survival-fill" id="survival-bar" style="width: 100%;"></div>
            </div>
            <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                Estimated Survival Time Remaining
            </p>
            
            <div class="mob-actions">
                <button class="mob-btn btn-ack" onclick="TelemetrySystem.acknowledgeMOB()">
                    <i class="fas fa-check"></i> Acknowledge & Mark Position
                </button>
                <button class="mob-btn btn-pattern" onclick="TelemetrySystem.initiateSearchPattern()">
                    <i class="fas fa-search-location"></i> Initiate SAR Pattern
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="panel-title">
                <i class="fas fa-chart-line"></i> Live Statistics
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <span>Active Alerts</span>
                    <i class="fas fa-exclamation-triangle" style="color: var(--alert-red);"></i>
                </div>
                <div class="stat-value" id="stat-alerts">0</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span>Data Points</span>
                    <i class="fas fa-database" style="color: var(--marine-accent);"></i>
                </div>
                <div class="stat-value" id="stat-records">0</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span>Vessel Speed</span>
                    <i class="fas fa-ship" style="color: var(--safe-green);"></i>
                </div>
                <div class="stat-value" id="vessel-speed">18.5</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">knots</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <span>Distance from MOB</span>
                    <i class="fas fa-ruler" style="color: var(--warning-yellow);"></i>
                </div>
                <div class="stat-value" id="mob-distance">--</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">nautical miles</div>
            </div>

            <div class="status-grid">
                <div class="status-item status-safe">
                    <span class="status-number" id="count-safe" style="color: var(--safe-green);">0</span>
                    <span style="font-size: 0.75rem; color: var(--text-secondary);">Safe</span>
                </div>
                <div class="status-item status-warning">
                    <span class="status-number" id="count-warning" style="color: var(--warning-yellow);">0</span>
                    <span style="font-size: 0.75rem; color: var(--text-secondary);">Warning</span>
                </div>
                <div class="status-item status-alert">
                    <span class="status-number" id="count-alert" style="color: var(--alert-red);">0</span>
                    <span style="font-size: 0.75rem; color: var(--text-secondary);">Alert</span>
                </div>
                <div class="status-item status-mob">
                    <span class="status-number" id="count-mob" style="color: #ff00ff;">0</span>
                    <span style="font-size: 0.75rem; color: var(--text-secondary);">MOB</span>
                </div>
            </div>

            <div style="margin-top: 25px;">
                <div class="panel-title">
                    <i class="fas fa-users"></i> Crew Status
                </div>
                <div id="crew-list" style="font-size: 0.85rem;"></div>
            </div>

            <div style="margin-top: 25px;">
                <div class="panel-title">
                    <i class="fas fa-route"></i> Vessel Status
                </div>
                <div id="vessel-status" style="font-size: 0.85rem; color: var(--text-secondary);">
                    Following shipping lane: English Channel Westbound
                </div>
            </div>
        </aside>

        <!-- Center: Map -->
        <main class="map-container">
            <div id="map"></div>
            
            <div class="map-overlay" id="map-overlay">
                <div class="overlay-header">
                    <span style="font-weight: bold; color: var(--marine-accent);">
                        <i class="fas fa-info-circle"></i> Vessel Info
                    </span>
                    <button class="minimize-btn" onclick="toggleOverlay()" title="Minimize/Maximize">
                        <i class="fas fa-minus" id="minimize-icon"></i>
                    </button>
                </div>
                <div class="overlay-content">
                    <div class="coord-display" id="vessel-coords">
                        Vessel: N 50° 54.582' W 001° 24.264'
                    </div>
                    <div class="coord-display" id="wind-data" style="margin-top: 5px;">
                        Wind: 15kt NW
                    </div>
                    <div class="env-data">
                        <div>Current: 2.3kt SW</div>
                        <div>Wave Height: 2.1m</div>
                        <div>Water Temp: 12.5°C</div>
                        <div>Visibility: 8.0 NM</div>
                        <div style="margin-top: 8px; color: var(--marine-accent);">
                            <i class="fas fa-clock"></i> UTC: <span id="utc-time">--:--:--</span>
                        </div>
                    </div>
                    <div class="shipping-lane-info" id="lane-info">
                        <i class="fas fa-info-circle"></i> In TSS: English Channel Westbound Lane
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Panel -->
        <aside class="control-panel">
            <div class="panel-title">
                <i class="fas fa-cogs"></i> Simulation Controls
            </div>

            <div class="control-group">
                <label class="control-label">Map Type</label>
                <select id="map-theme" onchange="MapManager.changeTheme(this.value)">
                    <option value="satellite" selected>Satellite (Realistic)</option>
                    <option value="standard">Standard (Colorful)</option>
                    <option value="nautical">Nautical Charts</option>
                </select>
            </div>

            <div class="control-group">
                <label class="control-label">Simulation Speed: <span id="speed-display">1x</span></label>
                <input type="range" id="sim-speed" min="1" max="20" value="1" oninput="TelemetrySystem.setSimulationSpeed(this.value)">
            </div>

            <div class="control-group">
                <label class="control-label">Environment</label>
                <select id="env-preset" onchange="TelemetrySystem.setEnvironment(this.value)">
                    <option value="channel" selected>English Channel (12°C)</option>
                    <option value="med">Mediterranean (22°C)</option>
                    <option value="arctic">Arctic (2°C)</option>
                    <option value="tropical">Tropical (28°C)</option>
                </select>
            </div>

            <div class="control-group">
                <label class="control-label">Recovery Maneuver</label>
                <select id="maneuver-type">
                    <option value="williamson" selected>Williamson Turn (Poor Visibility)</option>
                    <option value="anderson">Anderson Turn (Clear Visibility)</option>
                    <option value="scharnow">Scharnow Turn (Single Screw)</option>
                </select>
            </div>

            <button class="btn-primary btn-danger" onclick="TelemetrySystem.simulateMOB()">
                <i class="fas fa-exclamation-circle"></i> SIMULATE MOB EVENT
            </button>

            <button class="btn-primary" id="recovery-btn" onclick="TelemetrySystem.startRecovery()" disabled>
                <i class="fas fa-life-ring"></i> Execute Recovery Turn
            </button>

            <button class="btn-primary" onclick="TelemetrySystem.resetSimulation()">
                <i class="fas fa-redo"></i> Reset Simulation
            </button>

            <div style="margin-top: 25px;">
                <div class="panel-title">
                    <i class="fas fa-history"></i> Event Log
                </div>
                <div class="alert-log" id="alert-log"></div>
            </div>
        </aside>
    </div>

    <script src="js/telemetry.js"></script>
    <script src="js/map-manager.js"></script>
    <script src="js/simulation.js"></script>
</body>
</html>